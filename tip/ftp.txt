FTP: File Transfer Protocal
    21/tcp:

文件共享服务：应用层，ftp
    NFS: Network File System(RPC: Remote Procedure Call,远程过程调用)
    Samba: CIFS/SMB,(如windows网上邻居，跨平台)

FTP: tcp, 
    两个连接
        命令连接/控制连接(一直在线)
        数据连接(按需打开，按需关闭)
        注意：命令连接与数据连接不是一个端口

    主动模式：20/tcp
    被动模式：端口随机(防火墙可以追踪相关联的连接)

    {
        杀毒：检测我们所访问的文件来判定是否有危险
        防火墙：当我们的电脑连接到互联网上时检测是否有危险，说白了关闭用不到的端口
            防火墙规则：自己定义什么时候出去，什么人进来。
    }

    数据传输模式(自动模式)：
        二进制
        文本
        ftp server --> ftp client

服务器端程序：
    vsftpd: Very Secure ftp Daemon(安全性)
    proftpd:

    Filezilla:
    Serv-U:

客户端程序
    CLI: ftp , lftp
    GUI: gftpd , FlashFXP , Cuteftp, Filezilla

vsftpd:
    /etc/vsftpd: 配置文件目录
    /etc/init.d/vsftpd: 服务脚本
    /usr/sbin/vsftpd: 主程序

    基于PAM实现用户认证：
    /etc/pam.d/*
    /lib/security/*
    /lib64/security/*
    支持虚拟用户

varftpd: (ftp, ftp)
    /var/ftp:

上传，下载

ftp: 用户
    匿名用户
    虚拟用户
    系统用户

安装vsftpd：
    yum install vsftpd

    /var/ftp => ftp的家目录
    运行着身份：ftp

启动vsftpd
    service vsftpd start
    连接自动启动
    chkconfig vsftpd on

公开文件数据存储在/var/ftp/pub目录下

注意：查看防火墙是否关闭
    iptables -L -n

使用windows ftp 客户端
{
    PS C:\Windows\system32> ftp 112.74.202.56
    连接到 112.74.202.56。
    220 (vsFTPd 2.2.2)
    200 Always in UTF8 mode.
    用户(112.74.202.56:(none)): anonymous // 匿名用户
    331 Please specify the password.
    密码:
    230 Login successful.
    ftp> 
    {
        help
        bye
        get: 
        mget: 一次下载多个文件
        put: 上传
        mput: 一次上传多个文件
        rename: 改文件名
        mkdir

    }
}


ftp配置文件
    /etc/vsftpd/vsftpd.conf
    vim /etc/vsftpd/vsftpd.conf
    {
        任何一个指令前面不能有空格，不然就是语法错误

        anonymous_enable=YES: 是否启用匿名用户(匿名用户访问的是var/ftp：匿名用户默认对任何用户都没有上传权限)
        local_enable=YES: 是否启用系统用户 (每个系统用户通过ftp访问的是他的家目录)
            系统用户登录在他自己的权限之内可以到处访问，这是非常不安全的，而且密码用户名都没有经过加密。此时应该启动禁锢用户于其在家目录中
        write_enable=YES: 是否能上传文件(对于系统用户)


        anon_update_enable=YES
            打开匿名用户上传权限
            注意：此时匿名用户仍然不能上传，因为/var/ftp/pub目录是root权限，而匿名用户是ftp，此时ftp没有对pub用户的写权限。
            解决方法：创建一个上传目录给予ftp用户权限
                mkdir /var/ftp/upload
                setfacl -m u:ftp:rwx /var/ftp/upload  
                getfacl /var/ftp/upload
            此时不能创建目录与删除(因为还有ftp权限需要配置)
            此时需要配置：

        anno_mkdir_write_enable=YES // 匿名用户创建目录权限
        anno_other_write_enable=YES // 匿名用户删除的权限

        dirmessage_enable=YES // 显示进入目录欢迎信息(信息在.message里面)
            vim /var/ftp/upload/.message
                编辑文件信息

        xferlog_enable=YES // 是否打开传送日志
        xferlog_file=/var/log/xferlog // 启动日志记录文件
            这两项一起打开才有传送日志
        xferlog_std_format=YES // 日志是否使用标准格式

        chown_uploads=YES
        chown_username=whoever
            用户上传的文件属组树主

        ascii_upload_enable=YES // 使用文本格式上传下载(一般不开启)
        ascii_download_enable=YES

        chroot_list_enable=YES // 用一个文件把系统用户锁定到家目录
        chroot_list_file=/etc/vsftpd/chroot_list // 上面的配置文件
        chroot_local_user=YES //每个用户都禁锢到家目录(前面两项不需要)

        listen=YES // 配置为独立守护进程
            守护进程：
                独立守护
                瞬时守护
                    由xinetd代为管理



        pam_service_name=vsftpd
            /etc/pam.d/vsftpd 文件的名是什么
        userlist_enable=YES // 表示启用 user_list
            在/etc/vsftpd/user_list里面，默认列出的所有用户默认不能访问ftp
        userlist_deny=YES // 拒接userlist登录ftp，NO为允许
            这两个一起使用

        max_clients // 最多允许多少个客户端同时连接
        max_per_ip // 每个ip最多同时发起几个连接请求

        tcp_wrappers=YES

    }

    {
        创建用户密码
        useradd hadoop
        echo 'hadoop' | passwd --stdin hadoop
    }

    共享文件权限取决于两个权限：
        文件系统权限(系统用户给予的上传目录权限)*文件共享权限(ftp给予的共享权限)


安全通讯方式：(由于ftp密码是明文的，所以要加密)
    ftps: ftp + ssl/tls
    sftp: OpenSSH, SubSystem, sftp(SSH)

    {
        ssl_enable=YES
        ssl_tlsv1=YES
        ssl_sslv3=YES
        allow_anon_ssl=NO
        force_local_data_ssl=YES
        force_local_logins_ssl=YES
        rsa_cert_file=/etc/vsftpd/ssl/vsftpd_cert.pem
        rsa_private_key_file=/etc/vsftpd/ssl/vsftpd_key.pem
    }

    {
        cd /etc/pki/CA
        mkdir certs newcerts crl
        touch index.txt
        echo 01 > serial
        (umask 077;openssl genrsa -out private/cakey.pem 2048)
        openssl req -new -x509 -key private/cakey.pem -out cacert.pem -days 3650
        CN
        HN
        ZZ
        MageEdu
        Tech
        ca.magedu.com // 访问服务的名称保持一致
        mkdir /etc/vsftpd/ssl
        cd /etc/vsftpd/ssl
        (umask 007;openssl genrsa -out vsftpd.key 2048;)
        openssl req -new -key vsftpd.key -out vsftpd.csr
    }